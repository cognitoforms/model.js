!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.exomodel={})}(this,function(e){"use strict";var a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}var u=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.unsub=e,this.propagationStopped=!1}return e.prototype.stopPropagation=function(){this.propagationStopped=!0},e}();t.EventManagement=n});t(u);u.EventManagement;var o=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.handler=e,this.isOnce=t,this.isExecuted=!1}return e.prototype.execute=function(e,t,n){if(!this.isOnce||!this.isExecuted){this.isExecuted=!0;var r=this.handler;e?setTimeout(function(){r.apply(t,n)},1):r.apply(t,n)}},e}();t.Subscription=n});t(o);o.Subscription;var r=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._wrap=new i(this),this._subscriptions=new Array}return e.prototype.subscribe=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!1)),function(){t.unsubscribe(e)}},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.one=function(e){var t=this;return e&&this._subscriptions.push(new o.Subscription(e,!0)),function(){t.unsubscribe(e)}},e.prototype.has=function(t){return!!t&&this._subscriptions.some(function(e){return e.handler==t})},e.prototype.unsubscribe=function(e){if(e)for(var t=0;t<this._subscriptions.length;t++)if(this._subscriptions[t].handler==e){this._subscriptions.splice(t,1);break}},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype._dispatch=function(r,i,o){for(var s=this,e=function(e){var t=new u.EventManagement(function(){return s.unsub(e.handler)}),n=Array.prototype.slice.call(o);if(n.push(t),e.execute(r,i,n),a.cleanup(e),!r&&t.propagationStopped)return"break"},a=this,t=0,n=this._subscriptions.slice();t<n.length;t++){if("break"===e(n[t]))break}},e.prototype.cleanup=function(e){if(e.isOnce&&e.isExecuted){var t=this._subscriptions.indexOf(e);-1<t&&this._subscriptions.splice(t,1)}},e.prototype.asEvent=function(){return this._wrap},e.prototype.clear=function(){this._subscriptions.splice(0,this._subscriptions.length)},e}();t.DispatcherBase=n;var r=function(){function e(){this._events={}}return e.prototype.get=function(e){var t=this._events[e];return t||(t=this.createDispatcher(),this._events[e]=t)},e.prototype.remove=function(e){delete this._events[e]},e}();t.EventListBase=r;var i=function(){function e(t){this._subscribe=function(e){return t.subscribe(e)},this._unsubscribe=function(e){return t.unsubscribe(e)},this._one=function(e){return t.one(e)},this._has=function(e){return t.has(e)},this._clear=function(){return t.clear()}}return e.prototype.subscribe=function(e){return this._subscribe(e)},e.prototype.sub=function(e){return this.subscribe(e)},e.prototype.unsubscribe=function(e){this._unsubscribe(e)},e.prototype.unsub=function(e){this.unsubscribe(e)},e.prototype.one=function(e){return this._one(e)},e.prototype.has=function(e){return this._has(e)},e.prototype.clear=function(){this._clear()},e}();t.DispatcherWrapper=i});t(r);r.DispatcherBase,r.EventListBase,r.DispatcherWrapper;var p=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DispatcherBase=r.DispatcherBase,t.DispatcherWrapper=r.DispatcherWrapper,t.EventListBase=r.EventListBase,t.Subscription=o.Subscription});t(p);p.DispatcherBase,p.DispatcherWrapper,p.EventListBase,p.Subscription;var i=n(function(e,t){var r,n=a&&a.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.dispatch=function(e,t){this._dispatch(!1,this,arguments)},t.prototype.dispatchAsync=function(e,t){this._dispatch(!0,this,arguments)},t.prototype.asEvent=function(){return e.prototype.asEvent.call(this)},t}(p.DispatcherBase);t.EventDispatcher=i;var o=function(e){function t(){return e.call(this)||this}return n(t,e),t.prototype.createDispatcher=function(){return new i},t}(p.EventListBase);t.EventList=o;var s=function(){function e(){this._events=new o}return Object.defineProperty(e.prototype,"events",{get:function(){return this._events},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(e,t){this._events.get(e).subscribe(t)},e.prototype.sub=function(e,t){this.subscribe(e,t)},e.prototype.unsubscribe=function(e,t){this._events.get(e).unsubscribe(t)},e.prototype.unsub=function(e,t){this.unsubscribe(e,t)},e.prototype.one=function(e,t){this._events.get(e).one(t)},e.prototype.has=function(e,t){return this._events.get(e).has(t)},e}();t.EventHandlingBase=s});t(i);i.EventDispatcher,i.EventList,i.EventHandlingBase;var s=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventDispatcher=i.EventDispatcher,t.EventHandlingBase=i.EventHandlingBase,t.EventList=i.EventList});t(s);var l=s.EventDispatcher;s.EventHandlingBase,s.EventList;function h(e,t){var n,r=t;return r.constructor===String?(n=r.split("."),r=window,n.forEach(function(e){if(void 0===(r=r[e]))throw new Error('Parent namespace "'+t+'" could not be found.')})):null==r&&(r=window),e in r?r[e]:r[e]={}}var c=/function\s*([\w_\$]*)/i;function f(e){var t=c.exec(e);return t&&t[1]||"{anonymous}"}var d=/\s([a-z|A-Z]+)/;function y(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).match(d)[1].toLowerCase()}function v(e,t){void 0===e&&(e=0),void 0===t&&(t=9);var n=Math.random();return 1===n?t:Math.floor(n*(t-e+1))+e}var b={secrets:{}};function g(e,t,n,r,i){var o;if(void 0===t&&(t=8),void 0===n&&(n=!0),void 0===r&&(r=!1),void 0===i&&(i=null),b.secrets.hasOwnProperty(e))(o=b.secrets[e]).indexOf(i);else{var s="";if(n)s=function(e,t){void 0===t&&(t=!1);for(var n="",r=0;r<e;r++){var i,o=v(0,t?35:25);i=o<=25?o+97:o-26+48,n+=String.fromCharCode(i)}return n}(t,r);else if(r)for(var a=0;a<t;a++)s+=v(0,9).toString();o=i?i+s:s,b.secrets[e]=o}return o}var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function m(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var w=g("ObservableList.markerField",3,!1,!0,"_oL"),E=function(){function e(){}return e.add=function(e,t){var n=[t],r=Array.prototype.push.apply(e,n)-1;e._changedEvent.dispatch(e,{added:n,addedIndex:r,removed:[],removedIndex:-1})},e.remove=function(e,t){var n=Array.prototype.indexOf.call(e,t);if(-1!==n){var r=Array.prototype.splice.call(e,n,1);return e._changedEvent.dispatch(e,{added:[],addedIndex:-1,removed:r,removedIndex:n}),!0}},e}(),O=function(t){function e(e){return void 0===e&&(e=null),t.apply(this,e)||this}return m(e,t),e.isObservableList=function(e){return Object.prototype.hasOwnProperty.call(e,w)&&!0===e[w]},e._markObservable=function(e){Object.defineProperty(e,w,{configurable:!1,enumerable:!1,value:!0,writable:!1})},e.ensureObservable=function(e){return this.isObservableList(e)?e:P.implementObservableList(e)},e.create=function(e){void 0===e&&(e=null);var t=new P(e);return P.ensureObservable(t)},e}(Array),P=function(n){function r(e){void 0===e&&(e=null);var t=n.call(this,e)||this;return r._initFields(t),O._markObservable(t),t}return m(r,n),r._initFields=function(e,t){void 0===t&&(t=null),null==t&&(t=new l),Object.defineProperty(e,"_changedEvent",{configurable:!1,enumerable:!1,value:t,writable:!1})},r.implementObservableList=function(e){return r._initFields(e),e.add=function(e){E.add(this,e)},e.remove=function(e){return E.remove(this,e)},Object.defineProperty(e,"changed",{get:function(){return this._changedEvent.asEvent()}}),r._markObservable(e),e},r.prototype.add=function(e){E.add(this,e)},r.prototype.remove=function(e){return E.remove(this,e)},Object.defineProperty(r.prototype,"changed",{get:function(){return this._changedEvent.asEvent()},enumerable:!0,configurable:!0}),r}(O),j=g("Property.fieldNamePrefix",3,!1,!0,"_fN"),N=function(){function t(e,t,n,r,i){this.containingType=e,this.name=t,this.jstype=n,this.isList=!0===r,this.isStatic=!0===i,this._changedEvent=new l,this._accessedEvent=new l,e.originForNewProperties&&(this._origin=e.originForNewProperties)}return Object.defineProperty(t.prototype,"fieldName",{get:function(){return j+"_"+this.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"changed",{get:function(){return this._changedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"accessed",{get:function(){return this._accessedEvent.asEvent()},enumerable:!0,configurable:!0}),t.prototype.equals=function(e){if(null!=e&&e instanceof t)return this===e},t.prototype.toString=function(){return this.isStatic?this.getPath():"this<"+this.containingType+">."+this.name},t.prototype.isDefinedBy=function(e){return this.containingType===e||e.isSubclassOf(this.containingType)},Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin?this._origin:this.containingType.origin},enumerable:!0,configurable:!0}),t.prototype.getPath=function(){return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t.prototype.canSetValue=function(e,t){if(void 0===t)return console.warn("You should not set property values to undefined, use null instead: property = "+this.name+"."),!0;if(null===t)return!0;if(t.constructor&&t.constructor.meta){for(var n=t.constructor.meta;n;n=n.baseType)if(n.jstype===this.jstype)return!0;return!1}var r=t.constructor;switch(y(t)){case"string":r=String;break;case"number":r=Number;break;case"boolean":r=Boolean;break;case"date":r=Date;break;case"array":r=Array}return r===this.jstype||r===Array&&this.isList&&t.every(function(e){if(e.constructor&&e.constructor.meta){for(var t=e.constructor.meta;t;t=t.baseType)if(t._jstype===this._jstype)return!0;return!1}},this)},t.prototype.value=function(e,t,n){void 0===n&&(n=null);var r=this.isStatic?this.containingType.jstype:e;if(null==r)throw new Error("Cannot "+(1<arguments.length?"set":"get")+" value for "+(this.isStatic?"":"non-")+'static property "'+this.getPath()+'" on type "'+this.containingType.fullName+'": target is null or undefined.');if(!(1<arguments.length))return S(this,r);x(this,r,t,!1,n)},t.prototype.rootedPath=function(e){if(this.isDefinedBy(e))return this.isStatic?this.containingType.fullName+"."+this.name:this.name},t}();function T(e,t){if(!t.hasOwnProperty(e.fieldName)){var n=(r=e.isList,i=e.jstype,r?[]:i!==Boolean&&(i===Number?0:null));Array.isArray(n)&&(n=O.ensureObservable(n)),function(r,i,o,e){void 0===e&&(e=!1);var t=i.isStatic?i.containingType.jstype:r;if((void 0===t[i.fieldName]||void 0===e||e)&&(Object.defineProperty(t,i.fieldName,{value:o,writable:!0}),o instanceof Array)){var n=O.ensureObservable(o);(o=n).changed.subscribe(function(e,t){if(t.added&&0<t.added.length||t.removed&&0<t.removed.length){var n={property:i,newValue:o,oldValue:void 0};n.changes=[{newItems:t.added,oldItems:t.removed}],n.collectionChanged=!0,i._changedEvent.dispatch(r,n)}})}}(t,e,n)}var r,i}function S(e,t){return T(e,t),e._accessedEvent.dispatch(t,{property:e,value:t[e.fieldName]}),t[e.fieldName]}function x(e,t,n,r,i){if(void 0===r&&(r=!1),void 0===i&&(i=null),T(e,t),!e.canSetValue(t,n))throw new Error("Cannot set "+e.name+"="+(void 0===n?"<undefined>":n)+" for instance "+t.meta.type.fullName+"|"+t.meta.id+": a value of type "+(e.jstype&&e.jstype.meta?e.jstype.meta.fullName:f(e.jstype))+" was expected.");var o=t[e.fieldName];if(e.isList)throw new Error("Property set on lists is not permitted");var s=null==o?o:o.valueOf(),a=null==n?n:n.valueOf();if(!(s===a||e.jstype===Number&&isNaN(s)&&isNaN(a))&&(t[e.fieldName]=n,void 0!==o)){var u={property:e,newValue:n,oldValue:o};if(i)for(var p in i)i.hasOwnProperty(p)&&(u[p]=i[p]);e._changedEvent.dispatch(t,u)}}var L=function(){function e(e,t,n,r){Object.defineProperty(this,"type",{value:e,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"entity",{value:t,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this,"id",{value:n,writable:!0,enumerable:!0,configurable:!1}),Object.defineProperty(this,"isNew",{value:r,writable:!0,enumerable:!0,configurable:!1})}return e.prototype.destroy=function(){this.type.unregister(this.entity)},e}(),A="+c",B=function(){function e(e,t,n,r){this.model=e,this.fullName=t,this._initNewEvent=new l,this._initExistingEvent=new l,this._propertyAddedEvent=new l,this._properties={},this.origin=r||"client",this.originForNewProperties=this.origin,this._pool={},this._legacyPool={},this._counter=0,Object.defineProperty(this,"rules",{value:[]});for(var i=M.getJsType(t,!0),o=t.split("."),s=o.shift(),a=M._allTypesRoot,u=window;0<o.length;)a=h(s,a),u=h(s,u),s=o.shift();var p,c,f=s;i=function(e,t,n){if(!I)if(e&&e.constructor===String){var r=e,i=p.get(r,!0);if(i)return t&&i.init(t),i;p.register(this,r,n),t&&this.init(t);for(var o=p;o;o=o.baseType)o._initExistingEvent.dispatch(o,{entity:this})}else{p.register(this,null,n),e&&this.set(e);for(var o=p;o;o=o.baseType)o._initNewEvent.dispatch(o,{entity:this})}},(p=this)._jstype=i,a[f]?a["$"+f]=i:a[f]=i,u[f]?u["$"+f]=i:u[f]=i,this.derivedTypes=[],n?(c=n._jstype,(this.baseType=n).derivedTypes.push(this)):(c=C,this.baseType=null),I=!0,this._jstype.prototype=new c,I=!1,this._jstype.prototype.constructor=this._jstype,Object.defineProperty(i,"meta",{value:this,configurable:!1,enumerable:!1,writable:!1}),e._types[t]=this}return Object.defineProperty(e.prototype,"propertyAdded",{get:function(){return this._propertyAddedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initNew",{get:function(){return this._initNewEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initExisting",{get:function(){return this._initExistingEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"newIdPrefix",{get:function(){return A.substring(1)},set:function(e){if("string"!=typeof e)throw new TypeError("Property `Type.newIdPrefix` must be a string, found <"+typeof e+">");if(0===e.length)throw new Error("Property `Type.newIdPrefix` cannot be empty string");A="+"+e},enumerable:!0,configurable:!0}),e.prototype.newId=function(){for(var e,t=this;t;t=t.baseType)e=Math.max(e||0,t._counter);for(t=this;t;t=t.baseType)t._counter=e+1;return A+e},e.prototype.register=function(e,t,n){var r;void 0===n&&(n=!1),2===arguments.length&&D(this,t),t||(t=this.newId(),r=!0),Object.defineProperty(e,"meta",{value:new L(this,e,t,r),configurable:!1,enumerable:!1,writable:!1});for(var i=t.toLowerCase(),o=this;o;o=o.baseType){if(o._pool.hasOwnProperty(i))throw new Error('Object "'+this.fullName+"|"+t+'" has already been registered.');o._pool[i]=e,o._known&&o._known.add(e)}n||this.model._entityRegisteredEvent.dispatch(this.model,{entity:e})},e.prototype.changeObjectId=function(e,t){D(this,e),D(this,t);var n=e.toLowerCase(),r=t.toLowerCase(),i=this._pool[n];if(i){i.meta._legacyId=e;for(var o=this;o;o=o.baseType)o._pool[r]=i,delete o._pool[n],o._legacyPool[n]=i;return i.meta.id=t,i}console.warn('Attempting to change id: Instance of type "'+this.fullName+'" with id = "'+e+'" could not be found.')},e.prototype.unregister=function(e){for(var t=this;t;t=t.baseType)delete t._pool[e.meta.id.toLowerCase()],e.meta._legacyId&&delete t._legacyPool[e.meta._legacyId.toLowerCase()],t._known&&t._known.remove(e);this.model._entityUnregisteredEvent.dispatch(this.model,{entity:e})},e.prototype.get=function(e,t){var n=e.toLowerCase(),r=this._pool[n]||this._legacyPool[n];if(r&&!0===t&&r.meta.type!==this)throw new Error("The entity with id='"+e+"' is expected to be of type '"+this.fullName+"' but found type '"+r.meta.type.fullName+"'.");return r},e.prototype.known=function(){var e=this._known;if(!e){var t=[];for(var n in this._pool)t.push(this._pool[n]);e=this._known=O.ensureObservable(t)}return e},Object.defineProperty(e.prototype,"jstype",{get:function(){return this._jstype},enumerable:!0,configurable:!0}),e.prototype.addProperty=function(e,t,n,r){var i,o,s,a,u,p,c,f,l,h=new N(this,e,t,n,r);return this._properties[e]=h,o=(i=h).containingType,s=i.isStatic?o.jstype:o.jstype.prototype,Object.defineProperty(s,i.name,{configurable:!1,enumerable:!0,get:(c=i,f=S,l=!0,void 0===l&&(l=!1),function(){var e=f(c,this,l);return e}),set:(a=i,u=x,void 0===p&&(p=!1),function(e){u(a,this,e,p)})}),this._propertyAddedEvent.dispatch(this,{property:h}),h},e.prototype.property=function(e){for(var t,n=this;n&&!t;n=n.baseType)if(t=n._properties[e])return t;return null},Object.defineProperty(e.prototype,"properties",{get:function(){for(var e=[],t=this;null!=t;t=t.baseType)for(var n in t._properties)t._properties.hasOwnProperty(n)&&e.push(t._properties[n]);return e},enumerable:!0,configurable:!0}),e.prototype.isSubclassOf=function(t){var n=!1;return function(e,t,n,r){void 0===r&&(r=null);for(var i=e[t];null!=i;i=i[t])if(!1===n.call(r||e,i))return}(this,"baseType",function(e){if(e===t)return!(n=!0)}),n},e.prototype.toString=function(){return this.fullName},e}();function D(e,t){if(null==t)throw new Error("Id cannot be "+(null===t?"null":"undefined")+" (entity = "+e.fullName+").");if("string"!==y(t))throw new Error("Id must be a string:  encountered id "+t+' of type "'+f(t.constructor)+'" (entity = '+e.fullName+").");if(""===t)throw new Error("Id cannot be a blank string (entity = "+e.fullName+").")}var I=!1;var k=["Object","String","Number","Boolean","Date","TimeSpan","Array"],M=function(){function s(){this._types={},this._typeAddedEvent=new l,this._entityRegisteredEvent=new l,this._entityUnregisteredEvent=new l}return Object.defineProperty(s.prototype,"typeAdded",{get:function(){return this._typeAddedEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"entityRegistered",{get:function(){return this._entityRegisteredEvent.asEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"entityUnregistered",{get:function(){return this._entityUnregisteredEvent.asEvent()},enumerable:!0,configurable:!0}),s.prototype.dispose=function(){},Object.defineProperty(s.prototype,"types",{get:function(){var e=[];for(var t in this._types)this._types.hasOwnProperty(t)&&e.push(this._types[t]);return e},enumerable:!0,configurable:!0}),s.prototype.addType=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n="client");var r=new B(this,e,t,n);return this._types[e]=r,this._typeAddedEvent.dispatch(this,{type:r}),r},s.getJsType=function(e,t){void 0===t&&(t=!1);var n=s._allTypesRoot,r=e.split(".");if(1===r.length&&-1<k.indexOf(e))return window[e];for(var i=0;i<r.length;i++){var o=r[i];if(void 0===(n=n[o])){if(t)return;throw new Error('The type "'+e+'" could not be found.  Failed on step "'+o+'".')}}return n},s._allTypesRoot={},s}(),C=function(){function t(){}return t.prototype.init=function(e,t){var n;for(var r in"string"==typeof e?(n={})[e]=t:n=e,n){var i=this.meta.type.property(r);if(!i)throw new Error('Could not find property "'+r+'" on type "'+this.meta.type.fullName+'".');i.value(this,t)}},t.prototype.set=function(e,t){var n;for(var r in"string"==typeof e?(n={})[e]=t:n=e,n){var i=this.meta.type.property(r);if(!i)throw new Error('Could not find property "'+r+'" on type "'+this.meta.type.fullName+'".');i.set(this,t,!1)}},t.prototype.get=function(e){return this.meta.type.property(e).value(this)},t.prototype.toString=function(e){return e?e.convert(this):t.toIdString(this)},t.toIdString=function(e){return e.meta.type.fullName+"|"+e.meta.id},t.fromIdString=function(e){var t=e.substring(0,e.indexOf("|")),n=e.substring(t.length+1);return M.getJsType(t).meta.get(n,!1)},t}();e.Entity=C,e.Property=N,e.Type=B,e.Model=M,Object.defineProperty(e,"__esModule",{value:!0})});
